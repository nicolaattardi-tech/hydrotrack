<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroTrack - Report</title>
    <link rel="stylesheet" href="global.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="pwa-header">
    <div class="brand">
        <img src="icon-192.png" alt="Logo">
        <span>Report</span>
    </div>
    <a href="index.html" class="header-action">
        <svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/></svg>
    </a>
    </header>

    <div style="padding: 20px; position: sticky; top: 60px; background: white; border-bottom: 1px solid #eee;">
        <canvas id="waterChart"></canvas>
    </div>

    <div class="history-log" id="logContainer">
        </div>

    <script>
        const state = JSON.parse(localStorage.getItem('waterTrackerData')) || { history: {} };
        const history = state.history || {};
        
        // 1. Render Graph
        const ctx = document.getElementById('waterChart').getContext('2d');
        const labels = Object.keys(history).slice(-7); // Last 7 days
        const data = labels.map(date => history[date].intake);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ml Intake',
                    data: data,
                    borderColor: '#A3D8FF',
                    tension: 0.4, // This makes the line curved!
                    fill: true,
                    backgroundColor: 'rgba(163, 216, 255, 0.2)'
                }]
            },
            options: { plugins: { legend: { display: false } } }
        });

        // 2. Render Log Cards
        const container = document.getElementById('logContainer');
        Object.keys(history).reverse().forEach(date => {
            const entry = history[date];
            const percent = Math.round((entry.intake / entry.target) * 100);
            const isMet = entry.intake >= entry.target;
            
            const card = document.createElement('div');
            card.className = `day-card ${isMet ? 'goal-met' : ''}`;
            card.innerHTML = `
                <div>${date}</div>
                <div style="text-align:right">${percent}%</div>
                <div class="intake-val">Intake: ${entry.intake}ml</div>
                <div style="text-align:right">Goal: ${entry.target}ml</div>
            `;
            container.appendChild(card);
        });
    </script>
</body>
</html>