<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HydroTrack</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="global.css">
    <meta name="theme-color" content="#A3D8FF">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        /* Home-specific layout tweaks */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px 20px 30px 20px; /* Extra bottom padding for mobile */
        }

        .target-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #555;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .target-value {
            font-weight: 900;
            font-size: 2rem;
            border-bottom: 2px dashed var(--light-blue);
            padding: 2px 5px;
            cursor: pointer;
        }

        .edit-input {
            width: 100px;
            font-size: 2rem;
            font-weight: 200;
            padding: 4px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: left;
            display: none;
        }

        .unit { font-size: 2rem; font-weight: 400; }

        .save-btn {
            display: none;
            background: var(--dark-blue);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }

        /* --- SVG CIRCLE STYLES --- */
        .progress-wrapper {
            position: relative;
            width: 240px;
            height: 240px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5; /* Sit above trackers */
        }

        .progress-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .track-circle {
            fill: none;
            stroke: #F0F0F0;
            stroke-width: 20;
        }

        .progress-circle {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            stroke-dasharray: 628.32; 
            stroke-dashoffset: 628.32;
            transition: stroke-dashoffset 0.8s ease-out;
        }

        .progress-text {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .percentage { font-size: 3.5rem; font-weight: 300; }
        .current-ml { color: #888888; margin-top: 5px; }

        /* --- CUSTOM TRACKERS (UPDATED) --- */
        .custom-tracker {
            position: absolute;
            bottom: -35px; /* Moved down */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 70px;
            z-index: 1; /* Sit behind circle */
            background: var(--bg-white);
            padding: 10px 8px;
            border-radius: 16px;
            border: 1px solid var(--border-color); /* Light grey border */
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* Soft drop shadow */
        }
        
        .left-tracker { left: -30px; }
        .right-tracker { right: -30px; }

        .stepper-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 2px;
        }

        .step-btn {
            background: var(--dark-blue);
            border: none;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .step-btn svg { width: 10px; height: 10px; fill: white; }
        .step-btn:active { transform: scale(0.85); opacity: 0.8; }

        .tracker-val {
            font-size: 1.4rem;
            font-weight:200;
            text-align: center;
            min-width: 20px;
        }

        .tracker-name {
            font-size: 0.7rem;
            font-weight: 700;
            border-bottom: 1.5px dashed var(--light-blue);
            margin-top: 8px;
            color: #666;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- STICKY BOTTOM CONTROLS --- */
        .controls-footer {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: auto; /* Pushes to bottom */
        }

        .controls {
            width: 100%;
            display: flex;
            justify-content: space-around;
        }

        .quick-add {
            background: none; border: none; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }

        .icon-circle {
            width: 60px; height: 60px;
            background-color: var(--light-blue);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s ease;
        }

        .icon-circle:active { transform: scale(0.9); }
        .icon-circle svg { width: 30px; height: 30px; fill: white; }
        .label-ml { font-size: 0.75rem; color: var(--grey-text); font-weight: 600; }

        .reset-link { 
            font-size: 0.75rem; 
            color: #bbb; 
            text-decoration: none; 
            cursor: pointer;
            padding: 5px 10px;
        }

        .hidden { display: none !important; }

        .tracker-val-input, .tracker-name-input {
            width: 100%; text-align: center; border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box;
        }
        .tracker-val-input { font-size: 1.2rem; padding: 2px; }
        .tracker-name-input { font-size: 0.7rem; margin-top: 4px; }
    </style>
</head>
<body>

    <header class="pwa-header">
        <div class="brand">
            <img src="icon-192.png" alt="Logo">
            <span>HydroTrack</span>
        </div>
        <a href="report.html" class="header-action">
            <svg viewBox="0 0 24 24"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/></svg>
        </a>
    </header>

    <main class="main-content">
        <div class="target-container">
            <span class="label">Target:</span>
            <div class="input-group">
                <span class="target-value" id="targetDisplay">2000</span>
                <input type="number" class="edit-input" id="targetInput">
                <span class="unit">ml</span>
                <button class="save-btn" id="saveTargetBtn">Save</button>
            </div>
        </div>

        <div class="progress-wrapper">
            <div class="custom-tracker left-tracker">
                <div class="stepper-container">
                    <button class="step-btn" onclick="stepTracker('t1Value', -1)">
                        <svg viewBox="0 0 24 24"><path d="M19,13H5V11H19V13Z" fill="white"/></svg>
                    </button>
                    <span id="t1ValueDisp" class="tracker-val">0</span>
                    <input type="number" id="t1ValueInp" class="tracker-val-input hidden">
                    <button class="step-btn" onclick="stepTracker('t1Value', 1)">
                        <svg viewBox="0 0 24 24"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="white"/></svg>
                    </button>
                </div>
                <span id="t1NameDisp" class="tracker-name">Coffee</span>
                <input type="text" id="t1NameInp" class="tracker-name-input hidden" maxlength="12">
            </div>

            <svg class="progress-svg" viewBox="0 0 240 240">
                <defs>
                    <filter id="inner-shadow">
                        <feOffset dx="2" dy="2"/>
                        <feGaussianBlur stdDeviation="3" result="offset-blur"/>
                        <feComposite operator="out" in="SourceGraphic" in2="offset-blur" result="inverse"/>
                        <feFlood flood-color="rgba(0,0,0,0.15)" result="color"/>
                        <feComposite operator="in" in="color" in2="inverse" result="shadow"/>
                        <feComposite operator="over" in="shadow" in2="SourceGraphic"/>
                    </filter>
                    <linearGradient id="blue-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#A3D8FF" />
                        <stop offset="100%" stop-color="#007AFF" />
                    </linearGradient>
                    <filter id="drop-shadow">
                        <feDropShadow dx="0" dy="4" stdDeviation="4" flood-opacity="0.3" flood-color="#007AFF"/>
                    </filter>
                </defs>
                <circle cx="120" cy="120" r="100" class="track-circle" filter="url(#inner-shadow)"></circle>
                <circle cx="120" cy="120" r="100" class="progress-circle" id="progressSvgLine" filter="url(#drop-shadow)" stroke="url(#blue-gradient)"></circle>
            </svg>
            
            <div class="progress-text">
                <div class="percentage" id="percentDisplay">0%</div>
                <div class="current-ml" id="mlDisplay">0 ml</div>
            </div>

            <div class="custom-tracker right-tracker">
                <div class="stepper-container">
                    <button class="step-btn" onclick="stepTracker('t2Value', -1)">
                        <svg viewBox="0 0 24 24"><path d="M19,13H5V11H19V13Z" fill="white"/></svg>
                    </button>
                    <span id="t2ValueDisp" class="tracker-val">0</span>
                    <input type="number" id="t2ValueInp" class="tracker-val-input hidden">
                    <button class="step-btn" onclick="stepTracker('t2Value', 1)">
                        <svg viewBox="0 0 24 24"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="white"/></svg>
                    </button>
                </div>
                <span id="t2NameDisp" class="tracker-name">Protein</span>
                <input type="text" id="t2NameInp" class="tracker-name-input hidden" maxlength="12">
            </div>
        </div>

        <div class="controls-footer">
            <div class="controls">
                <button class="quick-add" onclick="addWater(250)">
                    <div class="icon-circle"><svg viewBox="0 0 24 24"><path d="M5.004 10.229l-.003 -.186l.001 -.113l.008 -.071l1 -7a1 1 0 0 1 .877 -.853l.113 -.006h10a1 1 0 0 1 .968 .747l.022 .112l1.006 7.05l.004 .091c0 3.226 -2.56 5.564 -6 5.945v4.055h3a1 1 0 0 1 .117 1.993l-.117 .007h-8a1 1 0 0 1 -.117 -1.993l.117 -.007h3v-4.055c-3.358 -.371 -5.878 -2.609 -5.996 -5.716zm11.129 -6.229h-8.267l-.607 4.258a6.001 6.001 0 0 1 5.125 .787l.216 .155a4 4 0 0 0 4.32 .31l-.787 -5.51z" /></svg></div>
                    <span class="label-ml">250ml</span>
                </button>
                <button class="quick-add" onclick="addWater(600)">
                    <div class="icon-circle"><svg viewBox="0 0 24 24"><path d="M13 1a2 2 0 0 1 1.995 1.85l.005 .15v.5c0 1.317 .381 2.604 1.094 3.705l.17 .25l.05 .072a9.093 9.093 0 0 1 1.68 4.92l.006 .354v6.199a3 3 0 0 1 -2.824 2.995l-.176 .005h-6a3 3 0 0 1 -2.995 -2.824l-.005 -.176v-6.2a9.1 9.1 0 0 1 1.486 -4.982l.2 -.292l.05 -.069a6.823 6.823 0 0 0 1.264 -3.957v-.5a2 2 0 0 1 1.85 -1.995l.15 -.005h2zm.362 5h-2.724a8.827 8.827 0 0 1 -1.08 2.334l-.194 .284l-.05 .069a7.091 7.091 0 0 0 -1.307 3.798l-.003 .125a3.33 3.33 0 0 1 1.975 -.61a3.4 3.4 0 0 1 2.833 1.417c.27 .375 .706 .593 1.209 .583a1.4 1.4 0 0 0 1.166 -.583a3.4 3.4 0 0 1 .81 -.8l.003 .183c0 -1.37 -.396 -2.707 -1.137 -3.852l-.228 -.332a8.827 8.827 0 0 1 -1.273 -2.616z" /></svg></div>
                    <span class="label-ml">600ml</span>
                </button>
                <button class="quick-add" onclick="addWater(100)">
                    <div class="icon-circle"><svg viewBox="0 0 24 24"><path d="M12,2.1C10.1,4,6,8.4,6,12.5c0,3.3,2.7,6,6,6s6-2.7,6-6C18,8.4,13.9,4,12,2.1z"/></svg></div>
                    <span class="label-ml">100ml</span>
                </button>
            </div>
            <div class="reset-link" id="manualReset">Reset Today</div>
        </div>
    </main>

<script>
    /* ... (KEEP ALL YOUR EXISTING JAVASCRIPT CODE HERE - IT IS COMPATIBLE) ... */
    // The script logic for state, saveData, updateUI, stepTracker etc remains the same.
    // Ensure stepTracker and addWater functions are still defined as per your original script.
    
    // [Including your script logic below for a complete file]
    let state = {
        target: 2000,
        currentIntake: 0,
        t1Name: 'Coffee',
        t1Value: 0,
        t2Name: 'Protein',
        t2Value: 0,
        lastResetDate: new Date().toLocaleDateString(),
        history: {}
    };

    function stepTracker(stateKey, amount) {
        state[stateKey] = Math.max(0, (state[stateKey] || 0) + amount);
        saveData();
        updateUI();
    }

    const targetDisplay = document.getElementById('targetDisplay');
    const targetInput = document.getElementById('targetInput');
    const saveTargetBtn = document.getElementById('saveTargetBtn');
    const progressSvgLine = document.getElementById('progressSvgLine');
    const percentDisplay = document.getElementById('percentDisplay');
    const mlDisplay = document.getElementById('mlDisplay');
    const manualReset = document.getElementById('manualReset');

    let currentDisplayedIntake = 0; 
    let isInitialLoad = true;

    function init() {
        loadData();
        checkDailyReset();
        setupCustomTrackers();
        updateUI();
    }

    function loadData() {
        const saved = localStorage.getItem('waterTrackerData');
        if (saved) { state = { ...state, ...JSON.parse(saved) }; }
    }

    function saveData() { localStorage.setItem('waterTrackerData', JSON.stringify(state)); }

    function checkDailyReset() {
        const today = new Date().toLocaleDateString();
        if (state.lastResetDate !== today) {
            state.currentIntake = 0; state.t1Value = 0; state.t2Value = 0;
            state.lastResetDate = today; saveData();
        }
    }

    function setupEditable(displayId, inputId, stateKey, isNumber) {
        const displayEl = document.getElementById(displayId);
        const inputEl = document.getElementById(inputId);
        displayEl.onclick = () => {
            displayEl.classList.add('hidden');
            inputEl.classList.remove('hidden');
            inputEl.value = state[stateKey];
            inputEl.focus();
        };
        const saveChange = () => {
            state[stateKey] = isNumber ? (parseFloat(inputEl.value) || 0) : (inputEl.value.trim() || 'Custom');
            saveData(); updateUI();
            inputEl.classList.add('hidden');
            displayEl.classList.remove('hidden');
        };
        inputEl.addEventListener('blur', saveChange);
        inputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') inputEl.blur(); });
    }

    function setupCustomTrackers() {
        setupEditable('t1ValueDisp', 't1ValueInp', 't1Value', true);
        setupEditable('t1NameDisp', 't1NameInp', 't1Name', false);
        setupEditable('t2ValueDisp', 't2ValueInp', 't2Value', true);
        setupEditable('t2NameDisp', 't2NameInp', 't2Name', false);
    }

    function animateNumber(element, start, end, duration, suffix) {
        let startTime = null;
        const step = (timestamp) => {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            const easeOut = 1 - Math.pow(1 - progress, 3); 
            const currentVal = Math.floor(start + (end - start) * easeOut);
            element.innerText = `${currentVal}${suffix}`;
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }

    function updateUI() {
        const targetPercentage = Math.min(Math.round((state.currentIntake / state.target) * 100), 100);
        const circumference = 628.32; 
        progressSvgLine.style.strokeDashoffset = circumference - (targetPercentage / 100) * circumference;

        if (isInitialLoad) {
            percentDisplay.innerText = `${targetPercentage}%`;
            mlDisplay.innerText = `${state.currentIntake} ml`;
            currentDisplayedIntake = state.currentIntake;
            isInitialLoad = false;
        } else {
            animateNumber(percentDisplay, Math.min(Math.round((currentDisplayedIntake/state.target)*100),100), targetPercentage, 800, "%");
            animateNumber(mlDisplay, currentDisplayedIntake, state.currentIntake, 800, " ml");
            currentDisplayedIntake = state.currentIntake;
        }

        targetDisplay.innerText = state.target;
        document.getElementById('t1ValueDisp').innerText = state.t1Value;
        document.getElementById('t1NameDisp').innerText = state.t1Name;
        document.getElementById('t2ValueDisp').innerText = state.t2Value;
        document.getElementById('t2NameDisp').innerText = state.t2Name;
    }

    function addWater(amount) { state.currentIntake += amount; saveData(); updateUI(); }

    targetDisplay.onclick = () => {
        targetDisplay.classList.add('hidden');
        targetInput.classList.remove('hidden');
        targetInput.style.display = 'inline-block';
        targetInput.value = state.target;
        saveTargetBtn.style.display = 'inline-block';
        targetInput.focus();
    };

    saveTargetBtn.onclick = () => {
        const val = parseInt(targetInput.value);
        if (!isNaN(val) && val > 0) { state.target = val; saveData(); updateUI(); }
        targetDisplay.classList.remove('hidden');
        targetInput.style.display = 'none';
        saveTargetBtn.style.display = 'none';
    };

    manualReset.onclick = () => {
        if (confirm("Reset today's progress?")) {
            state.currentIntake = 0; state.t1Value = 0; state.t2Value = 0;
            saveData(); updateUI();
        }
    };

    init();
</script>
</body>
</html>