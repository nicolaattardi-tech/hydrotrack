<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HydroTrack</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#A3D8FF">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        :root {
            --light-blue: #A3D8FF;
            --grey-text: #888888;
            --light-grey: #F0F0F0;
            --bg-white: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-white);
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100dvh;
            padding: 20px;
            justify-content: space-between;
        }

        /* Top Section: Target */
        .header {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding-top: 10px;
        }

        .target-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            color: #555;
        }

        .target-value {
            font-weight: 600;
            border-bottom: 2px dashed var(--light-blue);
            padding: 2px 5px;
        }

        .edit-input {
            width: 80px;
            font-size: 1rem;
            padding: 4px;
            border: 1px solid var(--light-grey);
            border-radius: 4px;
            text-align: center;
            display: none;
        }

        .save-btn {
            display: none;
            background: var(--light-blue);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .reset-day-btn {
            position: absolute;
            right: 0;
            background: none;
            border: none;
            color: var(--grey-text);
            font-size: 0.8rem;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Middle Section: Progress Circle */
        .progress-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }

        .circle-outer {
            width: 240px;
            height: 240px;
            border-radius: 50%;
            background: conic-gradient(var(--light-blue) 0%, var(--light-grey) 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background 0.5s ease;
        }

        .circle-inner {
            width: 200px;
            height: 200px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.02);
        }

        .percentage {
            font-size: 3.5rem;
            font-weight: 300;
            color: #333;
        }

        .current-ml {
            font-size: 0.85rem;
            color: var(--grey-text);
            margin-top: 5px;
        }

        /* Bottom Section: Buttons */
        .controls {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding-bottom: 30px;
        }

        .quick-add {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .icon-circle {
            width: 60px;
            height: 60px;
            background-color: var(--light-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
        }

        .icon-circle:active {
            transform: scale(0.9);
        }

        .icon-circle svg {
            width: 30px;
            height: 30px;
            fill: white;
        }

        .label-ml {
            font-size: 0.75rem;
            color: var(--grey-text);
        }

        /* Utility */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <div class="target-container" id="targetContainer">
            <span>Target:</span>
            <span class="target-value" id="targetDisplay">2000</span>
            <input type="number" class="edit-input" id="targetInput" value="2000">
            <span>ml</span>
            <button class="save-btn" id="saveTargetBtn">Save</button>
        </div>
        <button class="reset-day-btn" id="manualReset">Reset</button>
    </div>

    <div class="progress-section">
        <div class="circle-outer" id="progressCircle">
            <div class="circle-inner">
                <div class="percentage" id="percentDisplay">0%</div>
                <div class="current-ml" id="mlDisplay">0 ml</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="quick-add" onclick="addWater(250)">
            <div class="icon-circle">
                <!-- Water Glass Icon -->
                <svg viewBox="0 0 24 24"><path d="M18.33,2l-1.33,12h-10L5.67,2H18.33 M21,0H3l2,18c0,1.1,0.9,2,2,2h10c1.1,0,2-0.9,2-2L21,0L21,0z"/></svg>
            </div>
            <span class="label-ml">250ml</span>
        </button>

        <button class="quick-add" onclick="addWater(600)">
            <div class="icon-circle">
                <!-- Bottle/Thermos Icon -->
                <svg viewBox="0 0 24 24"><path d="M15,2c0-1.1-0.9-2-2-2h-2C9.9,0,9,0.9,9,2v2h6V2z M17,11V6c0-1.1-0.9-2-2-2H9C7.9,4,7,4.9,7,6v5c-1.1,0-2,0.9-2,2v9 c0,1.1,0.9,2,2,2h10c1.1,0,2-0.9,2-2v-9C19,11.9,18.1,11,17,11z"/></svg>
            </div>
            <span class="label-ml">600ml</span>
        </button>

        <button class="quick-add" onclick="addWater(100)">
            <div class="icon-circle">
                <!-- Drop Icon -->
                <svg viewBox="0 0 24 24"><path d="M12,2.1L12,2.1C10.1,4,6,8.4,6,12.5c0,3.3,2.7,6,6,6s6-2.7,6-6C18,8.4,13.9,4,12,2.1z"/></svg>
            </div>
            <span class="label-ml">100ml</span>
        </button>
    </div>

    <script>
        // State management
        let state = {
            target: 2000,
            currentIntake: 0,
            lastResetDate: new Date().toLocaleDateString()
        };

        const targetDisplay = document.getElementById('targetDisplay');
        const targetInput = document.getElementById('targetInput');
        const saveTargetBtn = document.getElementById('saveTargetBtn');
        const progressCircle = document.getElementById('progressCircle');
        const percentDisplay = document.getElementById('percentDisplay');
        const mlDisplay = document.getElementById('mlDisplay');
        const manualReset = document.getElementById('manualReset');

        // Initialize App
        function init() {
            loadData();
            checkDailyReset();
            updateUI();
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('waterTrackerData');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('waterTrackerData', JSON.stringify(state));
        }

        // Check if date changed to reset intake
        function checkDailyReset() {
            const today = new Date().toLocaleDateString();
            if (state.lastResetDate !== today) {
                state.currentIntake = 0;
                state.lastResetDate = today;
                saveData();
            }
        }

        // Update visual elements
        function updateUI() {
            const percentage = Math.min(Math.round((state.currentIntake / state.target) * 100), 100);
            const remaining = 100 - percentage;
            
            // Update Circle Background
            progressCircle.style.background = `conic-gradient(var(--light-blue) ${percentage}%, var(--light-grey) ${percentage}%)`;
            
            // Update Texts
            percentDisplay.innerText = `${percentage}%`;
            mlDisplay.innerText = `${state.currentIntake} ml`;
            targetDisplay.innerText = state.target;
        }

        // Add Water logic
        function addWater(amount) {
            state.currentIntake += amount;
            saveData();
            updateUI();
        }

        // Target Editing logic
        targetDisplay.onclick = () => {
            targetDisplay.classList.add('hidden');
            targetInput.classList.remove('hidden');
            targetInput.style.display = 'block';
            targetInput.value = state.target;
            saveTargetBtn.style.display = 'inline-block';
            targetInput.focus();
        };

        saveTargetBtn.onclick = () => {
            const val = parseInt(targetInput.value);
            if (!isNaN(val) && val > 0) {
                state.target = val;
                saveData();
                updateUI();
            }
            targetDisplay.classList.remove('hidden');
            targetInput.style.display = 'none';
            saveTargetBtn.style.display = 'none';
        };

        // Manual Reset button logic
        manualReset.onclick = () => {
            if (confirm("Reset today's intake to 0?")) {
                state.currentIntake = 0;
                saveData();
                updateUI();
            }
        };
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registration successful:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
        // Initialize on load
        init();
    </script>
</body>
</html>